<%
layout("/layouts/platform.html"){
%>

<section class="main-content">
    <!-- content wrapper -->
    <div class="content-wrap">
        <!-- inner content wrapper -->
        <div class="wrapper">
            <div class="row">
                <div class="col-md-6">
                    <!-- profile information sidebar -->
                    <section class="panel overflow-hidden no-b profile p15">
                        <div class="row mb25">
                            <div class="col-sm-12">
                                <div class="row">
                                    <div class="col-xs-12 col-sm-4 text-center">
                                        <figure>
                                            <img src="/assets/img/avatar.jpg" alt=""
                                                 class="avatar avatar-lg img-circle avatar-bordered">
                                        </figure>
                                        <div class="row">
                                            <ul class="user-meta ">
                                                <li>
                                                    <i class="fa fa-beer mr5"></i>
                                                    <a href="javascript:;">${role.name}</a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="mt10 mb10">
                                            <a href="${base}/platform/gy/person/infedit" class="btn btn-social btn-xs btn-facebook mr5" data-toggle="modal" data-target="#dialogDeal"><i class="fa fa-info"></i>个人信息 </a>

                                            <a href="${base}/platform/gy/person/payindex" class="btn btn-social btn-xs btn-google-plus mr5"><i class="fa fa-rmb"></i>交易方式 </a>


                                            <!--<a id="emailchecked" class="btn btn-social btn-xs btn-twitter mr5"-->
                                               <!--v-if="!emailchecked" v-on:click="askActiviEmail('${obj.id}')"><i-->
                                                    <!--class="fa fa-mail-forward"></i>邮箱未激活，发送激活邮件 </a>-->
                                            <% if(!obj.emailChecked){ %>
                                                <a id="emailchecked" class="btn btn-social btn-xs btn-twitter mr5" onclick="askActiviEmail('${obj.id}')">
                                                    <i class="fa fa-mail-forward"></i>邮箱未激活，发送激活邮件
                                                </a>
                                            <%}%>
                                        </div>
                                    </div>


                                    <div class="col-xs-12 col-sm-8">
                                        <h4 class="mb5"><b>${gy.realname!}</b> ${@status.bind('sex'+gy.sex!)}，你好！ </h4>
                                        <h6 class="mt15 mb15">雇员编号：${gy.id!}</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6 class="mt15">基本信息</h6>
                                                <ul class="user-meta ">
                                                    <li>
                                                        <i class="fa fa-graduation-cap mr5"></i>
                                                        <span>${gy.college!}</span>
                                                    </li>
                                                    <li>
                                                        <i class="fa fa-institution mr5"></i>
                                                        <span>${gy.school!}</span>
                                                    </li>
                                                    <li>
                                                        <i class="fa fa-institution mr5"></i>
                                                        <span>${gy.major!}</span>
                                                    </li>
                                                    <li>
                                                        <i class="fa fa-cube mr5"></i>
                                                        <span>${@status.bind(
                                                            'stulevel'+gy.stuLevel!)}</span>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <h6 class="mt15">联系方式</h6>
                                                <ul class="user-meta ">
                                                    <li>
                                                        <i class="ti-email mr5"></i>
                                                        <span>${obj.email!}</span>
                                                    </li>
                                                    <li>
                                                        <i class="ti-mobile mr5"></i>
                                                        <span>${gy.phone!}</span>
                                                    </li>
                                                    <li>
                                                        <i class="fa fa-qq mr5"></i>
                                                        <span>${gy.qq!}</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section class="panel panel-default">
                        <header class="panel-heading">
                            <div class="pull-right">
                                <a class="mr5" href="javascript:;">
                                    <i class="ti-info-alt"></i>
                                </a>
                                <a href="javascript:;">
                                    <i class="ti-settings"></i>
                                </a>
                            </div>
                            <span class="small text-uppercase">平台认证</span>
                        </header>
                        <div class="panel-body no-p">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="chat-user" id="gyauth" onclick="gyauthedit()">
                                        <a class="user-avatar">
                                            <img src="/assets/img/face5.jpg" class="avatar avatar-sm img-circle" alt="">
                                            <div class="status bg-danger"></div>
                                        </a>
                                        <div class="user-details">
                                            <p>身份认证</p>
                                            <small class="user-department">${@status.bind('gyauth'+ gyauth.status!)}</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="chat-user">
                                        <a href="javascript:;" class="user-avatar">
                                            <img src="/assets/img/avatar.jpg" class="avatar avatar-sm img-circle" alt="">
                                            <div class="status bg-color"></div>
                                        </a>
                                        <div class="user-details">
                                            <p>技能认证</p>
                                            <small class="user-department">暂没有认证技能哦</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="col-md-6 mb25">

                    <section class="panel panel-primary no-b">
                        <header class="panel-heading">
                            <div class="pull-right">
                                <a class="mr5" href="javascript:;">
                                    <i class="ti-info-alt"></i>
                                </a>
                                <a href="javascript:;">
                                    <i class="ti-settings"></i>
                                </a>
                            </div>
                            <span class="small text-uppercase">任务概览</span>
                        </header>
                        <div class="panel-body p10">
                                    <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
                            <div id="main" style="height:300px;width: 100%"></div>
                        </div>

                    </section>
                </div>
            </div>
        </div>
        <!-- /inner content wrapper -->
    </div>
    <!-- /content wrapper -->
    <a class="exit-offscreen"></a>

    <!-- 状态框 -->
    <div id="dialogDeal" class="modal fade " tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
            </div>
        </div>
    </div>

    <div id="dialogAuthDeal" class="modal fade " tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
            </div>
        </div>
    </div>

    <div id="dialogPayDeal" class="modal fade " tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
            </div>
        </div>
    </div>

</section>


<script type="text/javascript" src="${base!}/assets/plugins/echart/echarts.js"></script>
<script>


    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('main'));

    // 显示标题，图例和空的坐标轴
    myChart.setOption({
        title : {
            text: '任务执行情况概览',
            subtext: '${gy.realname}',
            x:'center'
        },
        tooltip : {
            x : 'center',
            y : 'bottom',
            trigger: 'item',
            formatter: "{a} {b} : {c} ({d}%)"
         },
        toolbox: {
            show : true,
            feature : {
                mark : {show: true},
                dataView : {show: true, readOnly: false},
                magicType : {
                    show: true,
                    type: ['pie', 'funnel']
                },
                restore : {show: true},
                saveAsImage : {show: true}
            }
        },
        legend:{
            orient: 'vertical',
            left: 'left',
            data: []
         },
        calculable : true,
        series : [{
            name: '任务状态',
            type: 'pie',
            radius : '55%',
            center: ['50%', '60%'],
            data:[],
            itemStyle: {
                emphasis: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }]
    });
    myChart.showLoading();// 加载动画
    // 异步加载数据
    $.post('${AppApiDomain}/open/api/stat/xminf?gyid=${gy.id}').done(function (data) {//jQuery触发ajax 从后台异步获取数据
        if(data.code == 0){
            var array = new Array();
            var legendName = new Array();
            console.log(data)
            for(var i in data.data){//遍历packJson 数组时，i为索引
                var map ={};
                // console.log(i);
                // console.log(data.data[i]);
                map.name = i;
                map.value = data.data[i];
                console.log(map);
                array.push(map);
                legendName.push(i);
            }

            console.log(array);
            console.log(legendName);
            myChart.hideLoading();
            // 填入数据
            myChart.setOption({
                legend: {
                    data: legendName
                },
                series:[{
                    // 根据名字对应到相应的系列
                    name: '任务状态',
                    type: 'pie',
                    data:  array
                }],
            });
        }else{
            Toast.error(data.msg);
        }
    });


    function askActiviEmail(id) {
        var url = "${base}/open/api/sys/email/mail/activeMail?userid=" + id;
        $.post(url, function (data) {
            if (data.code == 0) {
                Toast.success(data.msg);
            } else {
                Toast.error(data.msg);
            }
        })
    }
    
    function gyauthedit() {
        // if (${gyauth.status} == 1 || ${gyauth.status} == 2)
        // {
        //     Toast.warning("您的身份信息正在she")
        //     return null;
        // }
        // if (!${isAuth}) {
            $("#dialogAuthDeal").modal({
                remote: "${base}/platform/gy/person/authedit"
            });
            $("#dialogAuthDeal").show();
        // } else {
        //     Toast.warning("身份已经验证！")
        // }
    }

    // // 首先,需要创建一个WebSocket连接
    // var ws;
    // var WS_URL = window.location.host + "${base!}" + "/websocket"
    // // 如果页面是https,那么必须走wss协议, 否则走ws协议
    // if (location.protocol == 'http:') {
    //     ws = new WebSocket("ws://" + WS_URL);
    // } else {
    //     ws = new WebSocket("wss://" + WS_URL);
    // }
    // // 连接成功后,会触发onopen回调
    // ws.onopen = function (event) {
    //     console.log("websocket建立：");
    //     // 加入home房间
    //     ws.send(JSON.stringify({room: 'home', "action": "join"}));
    // };
    // // 收到服务器发来的信息时触发的回调
    // ws.onmessage = function (event) {
    //     console.log("websocket onmessage", event.data);
    //     var re = JSON.parse(event.data);
    //     if (re.action == "notify") {
    //         // 弹个浏览器通知
    //     } else if (re.action == "msg") {
    //         // 插入到聊天记录中
    //     } else if (re.action == "refresh") {
    //         // 刷新本页
    //         window.location.reload();
    //     }
    // };
    // ws.onclose = function (evt) {
    //     console.log("Connection closed.");
    // };
    // // 定时发个空消息,避免服务器断开连接
    // function ws_ping() {
    //     if (ws) {
    //         ws.send("{}"); // TODO 断线重连.
    //     }
    // }
    // setInterval("ws_ping()", 25000); // 25秒一次就可以了


</script>


<%}%>